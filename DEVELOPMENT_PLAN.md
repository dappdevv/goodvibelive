# üìã –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è Good Vibe Live ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –ë–î

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 17.10.2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High  
**–°—Ç–∞—Ç—É—Å:** Planning

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### –ß—Ç–æ –≥–æ—Ç–æ–≤–æ:
- ‚úÖ Next.js 15 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –±–∞–∑–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- ‚úÖ Supabase Auth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (email/password, Google OAuth)
- ‚úÖ Telegram Web App –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI (Header, BottomBar, Feed)
- ‚úÖ Zustand –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
- üî¥ –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î Supabase (–≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã)
- üî¥ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (9 —É—Ä–æ–≤–Ω–µ–π)
- üî¥ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ (—Å 7-–¥–Ω–µ–≤–Ω–æ–π —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–µ–π)
- üî¥ –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø–æ–¥–ø–∏—Å–æ–∫
- üî¥ API endpoints –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üî¥ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã –ë–î

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ **4 —Ñ–∞–∑—ã** –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:

### –§–∞–∑–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î (–Ω–µ–¥–µ–ª—è 1-2)
–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü, enum —Ç–∏–ø–æ–≤, –∏–Ω–¥–µ–∫—Å–æ–≤, RLS –ø–æ–ª–∏—Ç–∏–∫

### –§–∞–∑–∞ 2: SQL —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã (–Ω–µ–¥–µ–ª—è 2-3)
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ –ë–î: —Ä–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞–º–∏, —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ –¥–µ—Ä–µ–≤–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

### –§–∞–∑–∞ 3: API endpoints (–Ω–µ–¥–µ–ª—è 3-4)
Next.js API routes –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Å–ª–æ–∂–Ω—ã—Ö –ª–æ–≥–∏–∫

### –§–∞–∑–∞ 4: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–Ω–µ–¥–µ–ª—è 4-5)
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∫ API, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (–¥–µ—Ç–∞–ª—å–Ω–æ)

### üîê –†–∞–∑–¥–µ–ª 1: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª–∏

#### 1.1 –¢–∞–±–ª–∏—Ü–∞ `private_users`
–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É + service_role)

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE
email TEXT GENERATED ALWAYS AS (SELECT email FROM auth.users WHERE id = private_users.id) STORED
telegram_id BIGINT UNIQUE NULL
is_phone_verified BOOLEAN DEFAULT false
wallet_address TEXT UNIQUE NULL
referrer_id UUID REFERENCES private_users(id) ON DELETE SET NULL
created_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
-- –ò–Ω–¥–µ–∫—Å—ã: telegram_id, referrer_id
```

#### 1.2 –¢–∞–±–ª–∏—Ü–∞ `public_profiles`
–ü—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤–∏–¥–Ω—ã –≤—Å–µ–º)

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE
username TEXT UNIQUE NOT NULL
full_name TEXT NULL
avatar_url TEXT NULL
bio TEXT NULL (max 500 chars)
is_public BOOLEAN DEFAULT true
created_at TIMESTAMPTZ DEFAULT NOW()
updated_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
-- –ò–Ω–¥–µ–∫—Å—ã: username, is_public
```

---

### üí∞ –†–∞–∑–¥–µ–ª 2: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –∏ –±–∞–ª–∞–Ω—Å

#### 2.1 –¢–∞–±–ª–∏—Ü–∞ `user_balances`
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –ü–æ–ª—è:
user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE
balance BIGINT NOT NULL DEFAULT 0
updated_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç —Å–≤–æ–π –±–∞–ª–∞–Ω—Å
-- –ò–Ω–¥–µ–∫—Å—ã: user_id
```

#### 2.2 –¢–∞–±–ª–∏—Ü–∞ `subscription_tiers`
–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–æ–º)

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
name TEXT NOT NULL UNIQUE -- 'Free', 'Pro', 'Premium'
max_storage_bytes BIGINT NOT NULL -- 0, 1GB, 10GB
max_monthly_generations INT NOT NULL -- 0 (unlimited), 100, 500
price_monthly NUMERIC NOT NULL -- 0, 9.99, 29.99
created_at TIMESTAMPTZ DEFAULT NOW()

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
-- (Free, 0, 0, 0)
-- (Pro, 1073741824, 100, 9.99)
-- (Premium, 10737418240, 500, 29.99)
```

#### 2.3 –¢–∞–±–ª–∏—Ü–∞ `user_subscriptions`
–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
tier_id UUID NOT NULL REFERENCES subscription_tiers(id)
starts_at TIMESTAMPTZ NOT NULL
ends_at TIMESTAMPTZ NOT NULL
is_active BOOLEAN GENERATED ALWAYS AS (ends_at > NOW()) STORED
created_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏
-- –ò–Ω–¥–µ–∫—Å—ã: user_id, is_active, ends_at
```

---

### üåê –†–∞–∑–¥–µ–ª 3: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

#### 3.1 –¢–∞–±–ª–∏—Ü–∞ `referral_settings`
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –ü–æ–ª—è:
user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE
allow_referrer_referrals_registration BOOLEAN DEFAULT false
-- true = —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö —é–∑–µ—Ä–æ–≤ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –æ—Ç –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö

-- RLS: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç
-- –ò–Ω–¥–µ–∫—Å—ã: user_id
```

#### 3.2 –¢–∞–±–ª–∏—Ü–∞ `referral_tree`
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π –≤ –¥–µ—Ä–µ–≤–µ (–¥–æ 9 —É—Ä–æ–≤–Ω–µ–π)

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
referrer_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
referred_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE
level INT NOT NULL CHECK (level BETWEEN 1 AND 9)
created_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (–¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ä–µ–≤–∞), —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–æ–π
-- –ò–Ω–¥–µ–∫—Å—ã: referrer_id, referred_id, level, created_at
```

#### 3.3 –¢–∞–±–ª–∏—Ü–∞ `referral_commission_rules`
–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π –ø–æ —É—Ä–æ–≤–Ω—è–º (—Å—Ç–∞—Ç–∏—á–Ω–∞—è, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º)

```sql
-- –ü–æ–ª—è:
level INT PRIMARY KEY CHECK (level BETWEEN 1 AND 9)
commission_percent NUMERIC NOT NULL CHECK (commission_percent BETWEEN 0 AND 100)

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
-- (1, 27), (2, 10), (3, 5), (4, 5), (5, 5), (6, 5), (7, 10), (8, 20), (9, 3)
```

#### 3.4 –¢–∞–±–ª–∏—Ü–∞ `referral_commissions`
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç –∫–æ–º–∏—Å—Å–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
payer_user_id UUID NOT NULL REFERENCES auth.users(id)
receiver_user_id UUID NOT NULL REFERENCES auth.users(id)
level INT NOT NULL CHECK (level BETWEEN 1 AND 9)
amount NUMERIC NOT NULL CHECK (amount > 0)
subscription_id UUID REFERENCES user_subscriptions(id)
created_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∫–æ–º–∏—Å—Å–∏–∏
-- –ò–Ω–¥–µ–∫—Å—ã: receiver_user_id, created_at, payer_user_id
```

---

### üéÅ –†–∞–∑–¥–µ–ª 4: –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—Ä–∫–æ–≤

#### 4.1 Enum `GIFT_STATUS`
–°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–∞—Ä–∫–æ–≤

```sql
CREATE TYPE GIFT_STATUS AS ENUM (
  'pending',    -- –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º
  'accepted',   -- –ø—Ä–∏–Ω—è—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º
  'expired',    -- –∏—Å—Ç—ë–∫ 7-–¥–Ω–µ–≤–Ω—ã–π —Å—Ä–æ–∫
  'claimed',    -- –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∫–µ–º-—Ç–æ
  'rejected'    -- –æ—Ç–∫–ª–æ–Ω—ë–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º
);
```

#### 4.2 –¢–∞–±–ª–∏—Ü–∞ `gifts`
–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ —Å –ª–æ–≥–∏–∫–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª–∞

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
from_user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
to_user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE -- NULL = –ø—É–±–ª–∏—á–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
amount BIGINT NOT NULL CHECK (amount > 0)
message TEXT NULL (max 200 chars)
status GIFT_STATUS NOT NULL DEFAULT 'pending'
created_at TIMESTAMPTZ DEFAULT NOW()
expires_at TIMESTAMPTZ GENERATED ALWAYS AS (created_at + INTERVAL '7 days') STORED
created_referral BOOLEAN DEFAULT false -- —Ñ–ª–∞–≥: —Å–æ–∑–¥–∞–ª –ª–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

-- RLS: 
--   - from_user –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
--   - to_user –≤–∏–¥–∏—Ç –ø–æ–¥–∞—Ä–∫–∏ –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ –µ–º—É
--   - –ü—É–±–ª–∏—á–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ (to_user_id IS NULL) –≤–∏–¥–Ω—ã –≤—Å–µ–º —Å referrer_id IS NULL
-- –ò–Ω–¥–µ–∫—Å—ã: to_user_id, status, expires_at, from_user_id, created_at
```

---

### üé® –†–∞–∑–¥–µ–ª 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

#### 5.1 Enum `GENERATION_STATUS`
–°—Ç–∞—Ç—É—Å—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```sql
CREATE TYPE GENERATION_STATUS AS ENUM (
  'pending',     -- –æ–∂–∏–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  'processing',  -- –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  'completed',   -- —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
  'failed',      -- –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  'saved',       -- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ permanent storage
  'expired'      -- —É–¥–∞–ª–µ–Ω–æ –∏–∑ temp storage
);
```

#### 5.2 –¢–∞–±–ª–∏—Ü–∞ `generation_tasks`
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
cost_in_tokens INT NOT NULL
provider TEXT NOT NULL -- 'cometapi-gemini', 'cometapi-suno'
status GENERATION_STATUS NOT NULL DEFAULT 'pending'
prompt TEXT NULL
custom_lyrics TEXT NULL
request_metadata JSONB NULL
result_metadata JSONB NULL
temp_storage_path TEXT NULL
permanent_storage_path TEXT NULL
is_published BOOLEAN DEFAULT false
published_at TIMESTAMPTZ NULL
created_at TIMESTAMPTZ DEFAULT NOW()
updated_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
-- –ò–Ω–¥–µ–∫—Å—ã: user_id, status, is_published, created_at
```

---

### ‚ù§Ô∏è –†–∞–∑–¥–µ–ª 6: –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

#### 6.1 –¢–∞–±–ª–∏—Ü–∞ `likes`
–õ–∞–π–∫–∏ –Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

```sql
-- –ü–æ–ª—è:
user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
task_id UUID NOT NULL REFERENCES generation_tasks(id) ON DELETE CASCADE
created_at TIMESTAMPTZ DEFAULT NOW()

-- PK: (user_id, task_id)
-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ª–∞–π–∫–∞—Ç—å –ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
-- –ò–Ω–¥–µ–∫—Å—ã: user_id, task_id
```

#### 6.2 –¢–∞–±–ª–∏—Ü–∞ `favorites`
–ò–∑–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

```sql
-- –ü–æ–ª—è:
user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
task_id UUID NOT NULL REFERENCES generation_tasks(id) ON DELETE CASCADE
created_at TIMESTAMPTZ DEFAULT NOW()

-- PK: (user_id, task_id)
-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º –∏–∑–±—Ä–∞–Ω–Ω—ã–º
-- –ò–Ω–¥–µ–∫—Å—ã: user_id, task_id
```

#### 6.3 –¢–∞–±–ª–∏—Ü–∞ `follows`
–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```sql
-- –ü–æ–ª—è:
follower_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
following_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
created_at TIMESTAMPTZ DEFAULT NOW()

-- PK: (follower_id, following_id)
-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–≥–æ
-- –ò–Ω–¥–µ–∫—Å—ã: follower_id, following_id
```

#### 6.4 –¢–∞–±–ª–∏—Ü–∞ `donations`
–î–æ–Ω–∞—Ç—ã –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
from_user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
to_user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
amount BIGINT NOT NULL CHECK (amount > 0)
task_id UUID REFERENCES generation_tasks(id) ON DELETE SET NULL
message TEXT NULL
created_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –¥–æ–Ω–∞—Ç—ã
-- –ò–Ω–¥–µ–∫—Å—ã: from_user_id, to_user_id, created_at
```

---

### üìù –†–∞–∑–¥–µ–ª 7: –õ–∏—á–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π

#### 7.1 Enum `REMINDER_TYPE`
–¢–∏–ø—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

```sql
CREATE TYPE REMINDER_TYPE AS ENUM (
  'note',   -- –∑–∞–º–µ—Ç–∫–∞
  'task'    -- –∑–∞–¥–∞—á–∞
);
```

#### 7.2 –¢–∞–±–ª–∏—Ü–∞ `reminders`
–ó–∞–º–µ—Ç–∫–∏ –∏ –∑–∞–¥–∞—á–∏ —Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

```sql
-- –ü–æ–ª—è:
id UUID PRIMARY KEY DEFAULT gen_random_uuid()
user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE
title TEXT NOT NULL (max 200 chars)
description TEXT NULL (max 1000 chars)
reminder_type REMINDER_TYPE NOT NULL
is_completed BOOLEAN DEFAULT false
due_date TIMESTAMPTZ NULL
created_at TIMESTAMPTZ DEFAULT NOW()
updated_at TIMESTAMPTZ DEFAULT NOW()

-- RLS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏
-- –ò–Ω–¥–µ–∫—Å—ã: user_id, due_date, is_completed
```

---

## üîí RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (Row Level Security)

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `private_users`
- **SELECT**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü (auth.uid() = id)
- **INSERT/UPDATE/DELETE**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `public_profiles`
- **SELECT**: –í—Å–µ (–ø—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)
- **INSERT/UPDATE/DELETE**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `user_balances`
- **SELECT**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **INSERT/UPDATE/DELETE**: –¢–æ–ª—å–∫–æ service_role (—Å–∏—Å—Ç–µ–º–∞)

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `user_subscriptions`
- **SELECT**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **INSERT/UPDATE/DELETE**: –¢–æ–ª—å–∫–æ service_role

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `gifts`
- **SELECT**: 
  - –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ
  - –ü–æ–ª—É—á–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ –µ–º—É
  - –ü—É–±–ª–∏—á–Ω—ã–µ (to_user_id IS NULL) –≤–∏–¥–Ω—ã –≤—Å–µ–º —Å referrer_id IS NULL
- **INSERT**: –í—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **UPDATE/DELETE**: –¢–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –¥–ª—è pending —Å—Ç–∞—Ç—É—Å–∞

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `generation_tasks`
- **SELECT**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **INSERT**: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **UPDATE**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **DELETE**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- **SELECT**: –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
- **INSERT/DELETE**: –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

### –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è `reminders`
- **SELECT**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü
- **INSERT/UPDATE/DELETE**: –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü

---

## ‚öôÔ∏è SQL —Ñ—É–Ω–∫—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏—è 1: `find_placement_in_tree()`
–ü–æ–∏—Å–∫ –º–µ—Å—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞ –≤ –¥–µ—Ä–µ–≤–µ (–º–∞–∫—Å 6 –Ω–∞ —É—Ä–æ–≤–Ω–µ, —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ)

**–í—Ö–æ–¥**: 
- `p_inviter_id UUID` ‚Äî ID –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ
- `p_new_user_id UUID` ‚Äî ID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í—ã—Ö–æ–¥**: 
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å (1-9) –∏–ª–∏ –æ—à–∏–±–∫—É –µ—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ

**–õ–æ–≥–∏–∫–∞**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ `p_new_user_id` —É–∂–µ –≤ –¥–µ—Ä–µ–≤–µ
2. –°—á–∏—Ç–∞—Ç—å –ø—Ä—è–º—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ `p_inviter_id` –Ω–∞ —É—Ä–æ–≤–Ω–µ 1
3. –ï—Å–ª–∏ < 6, –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 1
4. –ò–Ω–∞—á–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ 2-9
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–ª–∞–≥ `allow_referrer_referrals_registration` —É –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞

---

### –§—É–Ω–∫—Ü–∏—è 2: `get_referral_commission_for_level()`
–†–∞—Å—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

**–í—Ö–æ–¥**: 
- `p_level INT` ‚Äî —É—Ä–æ–≤–µ–Ω—å (1-9)
- `p_amount NUMERIC` ‚Äî —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞

**–í—ã—Ö–æ–¥**: 
- NUMERIC ‚Äî —Ä–∞–∑–º–µ—Ä –∫–æ–º–∏—Å—Å–∏–∏

**–õ–æ–≥–∏–∫–∞**:
1. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑ `referral_commission_rules` –¥–ª—è —É—Ä–æ–≤–Ω—è
2. –í–µ—Ä–Ω—É—Ç—å `p_amount * percent / 100`

---

### –§—É–Ω–∫—Ü–∏—è 3: `auto_claim_expired_gifts()`
–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ (–ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –ø—É–±–ª–∏—á–Ω—ã–µ)

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**: Cron job –∫–∞–∂–¥—ã–π —á–∞—Å

**–õ–æ–≥–∏–∫–∞**:
1. –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending' –∏ `expires_at < NOW()`
2. –ò–∑–º–µ–Ω–∏—Ç—å –∏—Ö —Å—Ç–∞—Ç—É—Å –Ω–∞ 'expired'
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `to_user_id = NULL` (—Å–¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º–∏)

---

### –§—É–Ω–∫—Ü–∏—è 4: `distribute_referral_commission()`
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π –ø–æ —Ü–µ–ø–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–µ

**–í—Ö–æ–¥**: 
- `p_payer_id UUID` ‚Äî –∫—Ç–æ –ø–ª–∞—Ç–∏—Ç
- `p_subscription_id UUID` ‚Äî ID –ø–æ–¥–ø–∏—Å–∫–∏
- `p_amount NUMERIC` ‚Äî —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞

**–õ–æ–≥–∏–∫–∞**:
1. –ù–∞–π—Ç–∏ –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ `p_payer_id` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending' –¥–æ —É—Ä–æ–≤–Ω—è 9
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –µ–≥–æ –ø–æ–¥–ø–∏—Å–∫–∞
   - –ï—Å–ª–∏ –¥–∞, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–∏—Å—Å–∏—é –ø–æ —Ñ—É–Ω–∫—Ü–∏–∏ `get_referral_commission_for_level()`
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `referral_commissions`
   - –ó–∞—á–∏—Å–ª–∏—Ç—å –∫–æ–º–∏—Å—Å–∏—é –Ω–∞ –±–∞–ª–∞–Ω—Å (user_balances.balance += commission)

---

### –§—É–Ω–∫—Ü–∏—è 5: `accept_gift()`
–ü—Ä–∏–Ω—è—Ç–∏–µ –ø–æ–¥–∞—Ä–∫–∞ —Å –ª–æ–≥–∏–∫–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª–∞

**–í—Ö–æ–¥**: 
- `p_gift_id UUID` ‚Äî ID –ø–æ–¥–∞—Ä–∫–∞
- `p_user_id UUID` ‚Äî –∫—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç

**–õ–æ–≥–∏–∫–∞**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∞—Ä–∫–∞ = 'pending'
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `to_user_id = NULL` –ò–õ–ò `to_user_id = p_user_id`
3. –ï—Å–ª–∏ `to_user_id = NULL`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `referrer_id IS NULL` —É `p_user_id`
4. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å claimed, –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
5. –ó–∞—á–∏—Å–ª–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å: `user_balances.balance += amount`
6. –ï—Å–ª–∏ `referrer_id IS NULL` —É `p_user_id`, —Å–æ–∑–¥–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å:
   - –î–æ–±–∞–≤–∏—Ç—å `p_user_id` –≤ `referral_tree`
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `referrer_id = from_user_id`
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `created_referral = true`
7. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å = 'accepted' –∏–ª–∏ 'claimed'

---

## üìë –°—É–º–º–∏—Ä—É—é—â–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
graph LR
    subgraph Auth
        AuthUsers[auth.users]
    end
    
    subgraph Users
        PrivateUsers[private_users]
        PublicProfiles[public_profiles]
        UserBalances[user_balances]
    end
    
    subgraph Referral
        ReferralSettings[referral_settings]
        ReferralTree[referral_tree]
        ReferralCommissionRules[referral_commission_rules]
        ReferralCommissions[referral_commissions]
    end
    
    subgraph Monetization
        SubscriptionTiers[subscription_tiers]
        UserSubscriptions[user_subscriptions]
    end
    
    subgraph Gifts
        Gifts[gifts]
    end
    
    subgraph Content
        GenerationTasks[generation_tasks]
    end
    
    subgraph Social
        Likes[likes]
        Favorites[favorites]
        Follows[follows]
        Donations[donations]
    end
    
    subgraph Tools
        Reminders[reminders]
    end
    
    AuthUsers --> PrivateUsers
    AuthUsers --> PublicProfiles
    AuthUsers --> UserBalances
    AuthUsers --> ReferralSettings
    AuthUsers --> ReferralTree
    AuthUsers --> UserSubscriptions
    AuthUsers --> Gifts
    AuthUsers --> GenerationTasks
    AuthUsers --> Social
    AuthUsers --> Reminders
    
    SubscriptionTiers --> UserSubscriptions
    UserSubscriptions --> ReferralCommissions
    Gifts --> PrivateUsers
    GenerationTasks --> Social
```

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –¢–∞–±–ª–∏—Ü—ã
- [ ] –°–æ–∑–¥–∞—Ç—å enum GIFT_STATUS, GENERATION_STATUS, REMINDER_TYPE
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É private_users
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É public_profiles
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É user_balances
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É subscription_tiers (—Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É user_subscriptions
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É referral_settings
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É referral_tree
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É referral_commission_rules (—Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É referral_commissions
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É gifts
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É generation_tasks
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã likes, favorites, follows, donations
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É reminders

### –§–∞–∑–∞ 1.5: –ò–Ω–¥–µ–∫—Å—ã –∏ RLS
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

### –§–∞–∑–∞ 2: SQL —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é find_placement_in_tree
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é get_referral_commission_for_level
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é auto_claim_expired_gifts (—Å Cron —Ç—Ä–∏–≥–≥–µ—Ä–æ–º)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é distribute_referral_commission
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é accept_gift

### –§–∞–∑–∞ 3: API endpoints
- [ ] POST /api/users/profile ‚Äî —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- [ ] GET /api/users/profile/[username] ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- [ ] POST /api/gifts/send ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
- [ ] POST /api/gifts/accept ‚Äî –ø—Ä–∏–Ω—è—Ç—å –ø–æ–¥–∞—Ä–æ–∫
- [ ] GET /api/gifts/public ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏
- [ ] GET /api/referral/stats ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- [ ] GET /api/balance ‚Äî –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] POST /api/subscription/upgrade ‚Äî –∞–ø–≥—Ä–µ–π–¥ –ø–æ–¥–ø–∏—Å–∫–∏

### –§–∞–∑–∞ 4: –§—Ä–æ–Ω—Ç–µ–Ω–¥
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞–º–∏
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–æ–π

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —Å–º. —Ä–∞–∑–¥–µ–ª "–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã" –≤ [`project-description.md`](project-description.md).
